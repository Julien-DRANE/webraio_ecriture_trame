<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trame - R√©diger une chronique radio</title>
  <link rel="stylesheet" href="style.css">

  <!-- jsPDF + AutoTable depuis CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- üîπ Menu fixe -->
  <nav class="navbar">
    <a href="index.html">üè† Accueil</a>
    <a href="trame.html">‚úçÔ∏è Trame</a>
    <a href="annexe.html">üìë Annexe</a>
  </nav>

  <header>
    <h1>Trame</h1>
    <h2>R√©dige ta chronique radio</h2>
  </header>

  <main>
    <form class="trame-form">
      <h2>Rappel : Les 5W du journalisme</h2>
      <ul class="fivew">
        <li><strong>Who ?</strong> Qui est concern√© ?</li>
        <li><strong>What ?</strong> De quoi s‚Äôagit-il ?</li>
        <li><strong>Where ?</strong> O√π cela se passe-t-il ?</li>
        <li><strong>When ?</strong> Quand cela a-t-il lieu ?</li>
        <li><strong>Why ?</strong> Pourquoi en parler ?</li>
      </ul>

      <h2>Introduction</h2>
      <label for="intro1">1) D√©finition / phrase g√©n√©rale :</label>
      <textarea id="intro1" rows="3"></textarea>

      <label for="intro2">2) Probl√©matique :</label>
      <textarea id="intro2" rows="3"></textarea>

      <label for="intro3">3) Annonce du plan :</label>
      <textarea id="intro3" rows="3"></textarea>

      <h2>D√©veloppement</h2>
      <div id="dev-container">
        <div class="dev-field">
          <label>Argument 1 + exemple :</label>
          <textarea rows="4"></textarea>
        </div>
      </div>
      <button type="button" onclick="addArgument()">‚ûï Ajouter un argument</button>

      <h2>Conclusion</h2>
      <label for="concl1">1) R√©sum√© avec d‚Äôautres mots :</label>
      <textarea id="concl1" rows="3"></textarea>

      <label for="concl2">2) Nouvelle question :</label>
      <textarea id="concl2" rows="3"></textarea>

      <div class="actions">
        <button type="button" onclick="compilerChronique()">‚úÖ Valider et compiler</button>
        <button type="button" onclick="resetChronique()">üóëÔ∏è Nouvelle chronique</button>
      </div>
    </form>

    <section>
      <h2>Chronique finale</h2>
      <pre id="resultat" style="white-space: pre-wrap; background:#f4f7fa; padding:1rem; border-radius:8px;"></pre>

      <div class="export">
        <label for="fontSelect">Typographie :</label>
        <select id="fontSelect">
          <option value="times">Times</option>
          <option value="helvetica">Helvetica</option>
          <option value="courier">Courier</option>
        </select>

        <label for="fontSize">Taille :</label>
        <input type="number" id="fontSize" value="12" min="8" max="30">

        <button type="button" onclick="exportPDF()">üìÑ Exporter en PDF</button>
      </div>
    </section>
  </main>

  <!-- üîπ Script de gestion -->
  <script>
    let argCount = 1;

    function addArgument() {
      argCount++;
      const container = document.getElementById("dev-container");

      const div = document.createElement("div");
      div.classList.add("dev-field");

      div.innerHTML = `
        <label>Argument ${argCount} + exemple :</label>
        <textarea rows="4"></textarea>
        <button type="button" onclick="removeArgument(this)">‚ùå Supprimer</button>
      `;

      container.appendChild(div);
    }

    function removeArgument(btn) {
      btn.parentElement.remove();
    }

    // Compiler et sauvegarder le texte final
    function compilerChronique() {
      const intro1 = document.getElementById("intro1").value;
      const intro2 = document.getElementById("intro2").value;
      const intro3 = document.getElementById("intro3").value;

      const concl1 = document.getElementById("concl1").value;
      const concl2 = document.getElementById("concl2").value;

      // R√©cup√©rer les arguments dynamiques
      const args = Array.from(document.querySelectorAll("#dev-container textarea"))
        .map((ta, i) => `Argument ${i+1} : ${ta.value || "(vide)"}`)
        .join("\n");

      const texteFinal =
        "CHRONIQUE RADIO\n\n" +
        "Introduction :\n" +
        "1) " + (intro1 || "(vide)") + "\n" +
        "2) " + (intro2 || "(vide)") + "\n" +
        "3) " + (intro3 || "(vide)") + "\n\n" +
        "D√©veloppement :\n" +
        args + "\n\n" +
        "Conclusion :\n" +
        "1) " + (concl1 || "(vide)") + "\n" +
        "2) " + (concl2 || "(vide)");

      document.getElementById("resultat").textContent = texteFinal;
      localStorage.setItem("resultat", texteFinal);
    }

    // Effacer et recommencer
    function resetChronique() {
      if (confirm("Voulez-vous vraiment effacer cette chronique et recommencer ?")) {
        document.querySelectorAll("textarea").forEach(el => el.value = "");
        document.getElementById("resultat").textContent = "";
        localStorage.clear();
      }
    }

    // Export PDF (version fluide sans tableau)
    async function exportPDF() {
      const JsPDFCtor = window.jspdf?.jsPDF;
      if (!JsPDFCtor) {
        alert("jsPDF n'est pas charg√©.");
        return;
      }

      const doc = new JsPDFCtor({ unit: "mm", format: "a4" });

      // Couleurs bleues
      const bleuFonce = [0, 38, 84];   // #002654
      const bleuClair = [74, 144, 226]; // #4A90E2

      const margin = 20;
      const pageWidth = doc.internal.pageSize.getWidth() - margin * 2;
      let y = 20;

      // Fonction utilitaire pour √©crire un bloc multi-lignes
      function writeBlock(text, color = [0, 0, 0], bold = false) {
        doc.setFont("helvetica", bold ? "bold" : "normal");
        doc.setTextColor(...color);
        const lines = doc.splitTextToSize(text, pageWidth);
        lines.forEach(line => {
          if (y > doc.internal.pageSize.getHeight() - 20) {
            doc.addPage();
            y = 20;
          }
          doc.text(line, margin, y);
          y += 6;
        });
        y += 2;
      }

      // === Titre principal ===
      writeBlock("CHRONIQUE RADIO", bleuFonce, true);
      y += 6;

      // === Introduction ===
      writeBlock("Introduction", bleuClair, true);
      writeBlock("1) " + (document.getElementById("intro1").value || "(vide)"));
      writeBlock("2) " + (document.getElementById("intro2").value || "(vide)"));
      writeBlock("3) " + (document.getElementById("intro3").value || "(vide)"));
      y += 4;

      // === D√©veloppement ===
      writeBlock("D√©veloppement", bleuClair, true);
      const args = Array.from(document.querySelectorAll("#dev-container textarea"))
        .map((ta, i) => `Argument ${i+1} : ${ta.value || "(vide)"}`);
      args.forEach(line => writeBlock(line));
      y += 4;

      // === Conclusion ===
      writeBlock("Conclusion", bleuClair, true);
      writeBlock("1) " + (document.getElementById("concl1").value || "(vide)"));
      writeBlock("2) " + (document.getElementById("concl2").value || "(vide)"));

      // === Pied de page ===
      const pageCount = doc.internal.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(10);
        doc.setTextColor(150);
        doc.text(`Page ${i}/${pageCount}`, doc.internal.pageSize.getWidth() - 30, doc.internal.pageSize.getHeight() - 10);
        doc.text("Concours NON AU HARC√àLEMENT ‚Äì Atelier radio", margin, doc.internal.pageSize.getHeight() - 10);
      }

      doc.save("chronique.pdf");
    }
  </script>
</body>
</html>
